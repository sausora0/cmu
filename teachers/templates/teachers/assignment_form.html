{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Create Assignment | CMU Smart System</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
  <style>
    body { background: #f7f8fa; font-family: 'Google Sans', 'Roboto', Arial, sans-serif; }
    .gclass-assignment-header {
      display: flex; align-items: center; gap: 14px; padding: 15px 32px 15px 32px; background: #fff;
      border-bottom: 1px solid #ececec;
      position: relative;
    }
    .gclass-assignment-header .close-btn {
      background: none;
      border: none;
      font-size: 1.35rem;
      color: #757575;
      margin-right: 8px;
      transition: color 0.17s;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 38px;
      height: 38px;
      border-radius: 50%;
    }
    .gclass-assignment-header .close-btn:hover {
      color: #6366f1;
      background: #f3f5f8;
    }
    .gclass-assignment-header .fa-clipboard-list {
      font-size: 1.5rem;
      color: #6366f1;
    }
    .gclass-assignment-header h2 { font-size: 1.45rem; font-weight: 600; margin-bottom: 0; }
    .gclass-main {
      display: flex; gap: 0; min-height: 80vh; max-width: 1300px; margin: 0 auto; background: none;
    }
    .gclass-left { flex: 1.2; padding: 32px 18px 32px 32px; }
    .gclass-right {
      width: 350px; background: #fff; border-left: 1px solid #ececec; padding: 32px 28px; min-height: 100%;
      box-shadow: 0 0 0 #fff;
    }
    .gclass-card {
      background: #fff; border-radius: 14px; box-shadow: 0 2px 8px rgba(34,60,80,0.06); padding: 0;
      margin-bottom: 24px; border: 1px solid #e8e8e8;
    }
    .gclass-form-group {
      padding: 28px 26px 18px 26px; border-bottom: 1px solid #ececec;
    }
    .gclass-form-group:last-child { border-bottom: none; }
    .gclass-title-input {
      background: #e3e8ef; border: none; border-bottom: 2px solid #e57373; font-size: 1.2rem; font-weight: 500;
      padding: 16px 14px; width: 100%; border-radius: 7px 7px 0 0; outline: none;
    }
    .gclass-title-input:focus {
      background: #e3e8ef; border-bottom: 2px solid #6366f1;
    }
    .gclass-title-required {
      font-size: 0.97rem; color: #d32f2f; margin-left: 3px;
    }
    .gclass-instructions {
      background: #f3f5f8; border: none; font-size: 1.01rem; padding: 18px 12px; min-height: 120px; border-radius: 7px;
      width: 100%; resize: vertical; margin-bottom: 6px;
    }
    .gclass-editor-toolbar {
      display: flex; gap: 20px; margin-bottom: 12px; margin-left: 2px;
    }
    .gclass-editor-toolbar button {
      background: none; border: none; color: #757575; font-size: 1.1rem; padding: 0 2px; cursor: pointer;
      transition: color 0.2s;
    }
    .gclass-editor-toolbar button:hover { color: #6366f1; }
    .gclass-attach-group { padding: 18px 26px; }
    .gclass-attach-label { font-weight: 500; color: #3c4858; margin-bottom: 13px; }
    .gclass-attach-icons {
      display: flex; gap: 36px; align-items: center; margin-top: 8px;
    }
    .gclass-attach-icon {
      display: flex; flex-direction: column; align-items: center; gap: 4px; font-size: 1.02rem; color: #495057;
      cursor: pointer; transition: background 0.2s;
    }
    .gclass-attach-icon .icon-bg {
      background: #f7fafd; border-radius: 50%; width: 46px; height: 46px; display: flex; align-items: center; justify-content: center;
      margin-bottom: 2px; border: 1.3px solid #e3e8ef; transition: border 0.2s;
    }
    .gclass-attach-icon:hover .icon-bg {
      border: 1.3px solid #6366f1; background: #e3e8ef;
    }
    .gclass-right label, .gclass-right .form-label {
      font-weight: 500; color: #3c4858; margin-top: 18px; margin-bottom: 7px;
    }
    .gclass-right select, .gclass-right input[type="text"] {
      background: #f3f5f8; border-radius: 7px; border: none; padding: 11px 12px; font-size: 1rem; margin-bottom: 6px; width: 100%;
    }
    .gclass-right .form-control:focus, .gclass-right select:focus {
      outline: none; box-shadow: 0 0 0 1.5px #6366f1; border: none;
    }
    .gclass-right input[type="number"], .gclass-right input[type="date"], .gclass-right input[type="time"] {
      background: #f3f5f8; border-radius: 7px; border: none; padding: 11px 12px; font-size: 1rem; margin-bottom: 6px; width: 100%;
    }
    .gclass-right .assign-btn {
      background: linear-gradient(90deg, #6366f1 60%, #204ecf 100%);
      color: #fff; font-size: 1.15rem; border-radius: 22px; font-weight: 600; border: none; padding: 12px 40px;
      margin-top: 18px; transition: background 0.2s; width: 100%;
      box-shadow: 0 2px 8px rgba(34,60,80,0.12);
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }
    .gclass-right .assign-btn:hover {
      background: linear-gradient(90deg, #204ecf 0%, #6366f1 100%);
      box-shadow: 0 4px 12px rgba(34,60,80,0.14);
    }
    .gclass-right .rubric-btn {
      background: none; border: 1px solid #6366f1; color: #6366f1; border-radius: 22px; padding: 6px 22px; font-weight: 500;
      margin-top: 9px; margin-bottom: 10px; transition: background 0.2s, color 0.2s;
    }
    .gclass-right .rubric-btn:hover { background: #e3e8ef; color: #4751d7; }
    .gclass-right .all-students-btn {
      background: none; border: 1.5px solid #6366f1; color: #6366f1; border-radius: 25px; padding: 8px 0; font-weight: 500;
      margin-bottom: 10px; width: 100%; display: flex; align-items: center; gap: 9px; justify-content: center;
      transition: background 0.2s, color 0.2s;
    }
    .gclass-right .all-students-btn:hover {
      background: #e3e8ef; color: #4751d7; border-color: #4751d7;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="gclass-assignment-header">
    <button class="close-btn" onclick="window.history.back()" title="Back">
      <i class="fas fa-times"></i>
    </button>
    <i class="fas fa-clipboard-list"></i>
    <h2>Assignment</h2>
    
    <div class="ms-auto">
      <button type="submit" class="assign-btn" form="gclassAssignmentForm">
        <i class="fas fa-paper-plane"></i>
        Assign
      </button>
    </div>
  </div>
  <!-- Main Content -->
  <form id="gclassAssignmentForm" method="POST" enctype="multipart/form-data" autocomplete="off">
    {% csrf_token %}
    <div class="gclass-main">
      <!-- Left Section -->
      <div class="gclass-left">
        <div class="gclass-card mb-4">
          <div class="gclass-form-group">
            <input type="text" class="gclass-title-input" id="assignmentTitle" name="title" required maxlength="100" placeholder="Title*">
            <div class="gclass-title-required mb-2 ms-1">*Required</div>
            <label for="assignmentInstructions" class="form-label mt-3 mb-1">Instructions (optional)</label>
            <div class="gclass-editor-toolbar">
              <button type="button" title="Bold"><i class="fas fa-bold"></i></button>
              <button type="button" title="Italic"><i class="fas fa-italic"></i></button>
              <button type="button" title="Underline"><i class="fas fa-underline"></i></button>
              <button type="button" title="List"><i class="fas fa-list-ul"></i></button>
              <button type="button" title="Strike"><i class="fas fa-strikethrough"></i></button>
            </div>
            <textarea class="gclass-instructions" id="assignmentInstructions" name="instructions" rows="6"></textarea>
          </div>
        </div>
        <div class="gclass-card">
          <div class="gclass-attach-group">
            <div class="gclass-attach-label mb-2">Attach</div>
            <div class="gclass-attach-icons">
              <div class="gclass-attach-icon" title="Drive">
                <div class="icon-bg"><img src="{% static 'images/gdrive.webp' %}" alt="Drive" style="width:28px;"></div>
                <span>Drive</span>
              </div>
              <div class="gclass-attach-icon" title="YouTube">
                <div class="icon-bg"><img src="{% static 'images/youtube.png' %}" alt="YouTube" style="width:28px;"></div>
                <span>YouTube</span>
              </div>
              <div class="gclass-attach-icon" title="Create">
                <div class="icon-bg"><img src="{% static 'images/create.webp' %}" alt="Create" style="width:28px;"></div>
                <span>Create</span>
              </div>
              <label class="gclass-attach-icon" title="Upload" style="cursor:pointer;">
                <div class="icon-bg"><i class="fas fa-upload" style="font-size:22px; color:#6366f1;"></i></div>
                <span>Upload</span>
                <input type="file" name="attachment" style="display:none;" multiple>
              </label>
              <div class="gclass-attach-icon" title="Link">
                <div class="icon-bg"><i class="fas fa-link" style="font-size:22px; color:#6366f1;"></i></div>
                <span>Link</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Right Section -->
      <div class="gclass-right">
        <label for="classFor" class="form-label">For</label>
        <select id="classFor" name="class_for" class="form-control mb-3">
          {% for class in classes %}
            <option value="{{ class.id }}">{{ class.class_name }} {{ class.section }}</option>
          {% empty %}
            <option disabled>No classes found</option>
          {% endfor %}
        </select>
        <label class="form-label">Assign to</label>
        <button type="button" class="all-students-btn" data-bs-toggle="modal" data-bs-target="#assignToModal">
  <i class="fas fa-users"></i> Assign to
</button>

        <label for="assignmentPoints" class="form-label">Points</label>
        <input type="number" id="assignmentPoints" name="points" class="form-control mb-3" min="0" value="100" style="max-width:140px;">
        <label for="assignmentDueDate" class="form-label">Due date</label>
        <input type="date" id="assignmentDueDate" name="due_date" class="form-control mb-3">
        <label for="assignmentDueTime" class="form-label">Due time</label>
        <input type="time" id="assignmentDueTime" name="due_time" class="form-control mb-3">
        <label for="assignmentTopic" class="form-label">Topic</label>
        <select id="assignmentTopic" name="topic" class="form-control mb-3">
          <option>No topic</option>
          <option>Create Topic</option>
        </select>
        <label class="form-label">Rubric</label>
        <button type="button" class="rubric-btn"><i class="fas fa-plus"></i> Rubric</button>
      </div>
    </div>
  </form>
  <!-- Assign to Students Modal -->
<div class="modal fade" id="assignToModal" tabindex="-1" aria-labelledby="assignToModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="assignToModalLabel">Assign to</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
   

     <div class="modal-body">
  {% if students %}
    <div class="list-group">
      <!-- All Students -->
      <label class="list-group-item d-flex align-items-center fw-bold">
        <input class="form-check-input me-2" type="checkbox" id="selectAllStudents" name="assign_all" value="1">
        All Students
      </label>

      <!-- Individual Students -->
      {% for student in students %}
        <label class="list-group-item d-flex align-items-center">
          <input class="form-check-input me-2 student-check" type="checkbox" name="students" value="{{ student.id }}">
          {{ student.get_full_name }}
        </label>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-muted">No students found in this class.</p>
  {% endif %}
</div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="saveSelectedStudents()">Done</button>
      </div>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  
  function saveSelectedStudents() {
    let selected = [];
    document.querySelectorAll('input[name="students"]:checked').forEach(el => {
      selected.push(el.value);
    });
    
    // Optional: update button text with how many selected
    let btn = document.querySelector('.all-students-btn');
    if (selected.length > 0) {
      btn.innerHTML = `<i class="fas fa-users"></i> ${selected.length} selected`;
    } else {
      btn.innerHTML = `<i class="fas fa-users"></i> All students`;
    }

    // Close modal
    let modal = bootstrap.Modal.getInstance(document.getElementById('assignToModal'));
    modal.hide();
  }
  // Toggle all student checkboxes when "All Students" is clicked
  document.addEventListener("DOMContentLoaded", function() {
    const selectAll = document.getElementById("selectAllStudents");
    const studentChecks = document.querySelectorAll(".student-check");

    if (selectAll) {
      selectAll.addEventListener("change", function() {
        studentChecks.forEach(cb => cb.checked = selectAll.checked);
      });
    }

    // ✅ If all are manually checked, auto-check "All Students"
    studentCheckboxes.forEach(cb => {
      cb.addEventListener("change", function() {
        const allChecked = Array.from(studentCheckboxes).every(cb => cb.checked);
        selectAll.checked = allChecked;
      });
    });
  });
</script>

</body>
</html>